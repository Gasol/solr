#! /bin/sh /usr/share/dpatch/dpatch-run
## 05_use-debian-java-libraries.dpatch by Jan-Pascal van Best <janpascal@vanbest.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: Link to libraries under /usr/share/java instead of those 
## DP: included with upstream tarball. Do not include the libraries
## DP: into the war file.

@DPATCH@
diff -urNad solr~/build.xml solr/build.xml
--- solr~/build.xml	2008-09-24 23:09:28.000000000 +0200
+++ solr/build.xml	2008-09-24 23:11:26.000000000 +0200
@@ -22,7 +22,7 @@
   <import file="common-build.xml"/>
   
   <!-- 3rd party libraries for compilation -->
-  <property name="lib" value="lib" />
+  <property name="lib" value="/usr/share/java" />
 
   <!-- solr source files -->
   <property name="src" value="src" />
@@ -111,7 +111,27 @@
   <!-- The compilation classpath -->
   <path id="compile.classpath">
     <fileset dir="${lib}">
-      <include name="*.jar" />
+      <include name="servlet-api.jar" />
+      <include name="lucene-core.jar" />
+      <include name="lucene-analyzers.jar" />
+      <include name="lucene-highlighter.jar" />
+      <include name="lucene-queries.jar" />
+      <include name="lucene-snowball.jar" />
+      <include name="lucene-spellchecker.jar" />
+      <include name="commons-codec.jar" />
+      <include name="commons-csv.jar" />
+      <include name="commons-fileupload.jar" />
+      <include name="commons-httpclient.jar" />
+      <include name="commons-io.jar" />
+      <include name="commons-logging.jar" />
+      <include name="xpp3.jar" />
+      <include name="easymock.jar" />
+      <include name="jetty6.jar" />
+      <include name="jetty6-servlet2.5.jar" />
+      <include name="jetty6-util.jar" />
+    </fileset>
+    <fileset dir="/usr/local/share/java">
+      <include name="stax-utils.jar" />
     </fileset>
     <pathelement location="${dest}/common"/>
   </path>
@@ -305,6 +323,7 @@
     </fileset>
     <fileset dir="${lib}">
       <include name="commons-io-*.jar" />
+      <include name="commons-httpclient.jar" />
       <include name="*stax-*.jar" />
       <include name="wstx-*.jar" />
     </fileset>
@@ -318,8 +337,10 @@
     <pathelement location="${dest}/core"/>
     
     <!-- jetty -->
-    <fileset dir="example/lib">
-      <include name="**/*.jar" />
+    <fileset dir="/usr/share/java">
+      <include name="/jetty6.jar" />
+      <include name="/jetty6-servlet2.5.jar" />
+      <include name="/jetty6-util.jar" />
     </fileset>
   </path>
     
@@ -520,10 +540,6 @@
          webxml="${src}/webapp/web/WEB-INF/web.xml"
          filesetmanifest="skip"
          manifest="${dest}/META-INF/MANIFEST.MF">
-       <lib dir="${lib}">
-         <exclude name="servlet-api*.jar" />
-         <exclude name="easymock.jar" />
-       </lib>
        <lib dir="${dist}">
          <include name="${fullname}-core-${version}.jar" />
          <include name="${fullname}-common-${version}.jar" />
